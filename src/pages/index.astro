---
import Layout from '../layouts/Layout.astro';
import { getCollection } from 'astro:content';
import { useTranslations } from '../i18n/utils';

const t = useTranslations('en');
const base = import.meta.env.BASE_URL.replace(/\/$/, '');

const posts = (await getCollection('blog'))
  .sort((a, b) => new Date(a.data.date).getTime() - new Date(b.data.date).getTime());

const grouped = posts.reduce((acc, post) => {
  const cat = post.data.category;
  if (!acc[cat]) acc[cat] = [];
  acc[cat].push(post);
  return acc;
}, {} as Record<string, typeof posts>);
---

<Layout title={t('blog.title')} description={t('blog.description')} lang="en">
  <main>
    <h1>{t('blog.title')}</h1>
    <p>{t('blog.description')}</p>

    {Object.entries(grouped).map(([category, categoryPosts]) => (
      <section>
        <h2>{category}</h2>
        <ul>
          {categoryPosts.map((post) => (
            <li>
              <a href={`${base}/${post.id.replace(/\.mdx$/, '')}/`}>
                {post.data.title}
              </a>
            </li>
          ))}
        </ul>
      </section>
    ))}
  </main>
</Layout>
